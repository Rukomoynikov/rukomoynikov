<!DOCTYPE html>
<html lang="en" class="astro-IWK5W2YD">
  <head>
    <script defer data-domain="rukomoynikov.ru" src="https://plausible.io/js/plausible.js"></script>


<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<link rel="icon" type="image/x-icon" href="/favicon/favicon.ico">
<link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
<link rel="manifest" href="/favicon/site.webmanifest">
<link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#5bbad5">

<link rel="canonical" href="https://rukomoynikov.ru/posts/deploy-rails-on-amazon-lightsail/">
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Deploy Phoenix LiveView on Amazon LightSail">
<meta property="og:url" content="https://rukomoynikov.ru/posts/deploy-rails-on-amazon-lightsail/">
<meta property="og:image" content="https://rukomoynikov.ru/_image/assets/images/posts/elixir-telegram-bot/facebook-share_1200x630.jpg">
<meta property="og:description" content="This is the first part of three in the series. There you will find creating foundation and answering to users.">
<meta property="og:site_name" content="Max Rukomoynikov's site">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@rukomoynikov">
<meta name="twitter:creator" content="@rukomoynikov">
<meta name="twitter:title" content="Deploy Phoenix LiveView on Amazon LightSail">
<meta name="twitter:image" content="https://rukomoynikov.ru/_image/assets/images/posts/elixir-telegram-bot/facebook-share_1200x630.jpg">
<meta name="twitter:description" content="This is the first part of three in the series. There you will find creating foundation and answering to users.">
<meta name="twitter:label1" value="Author">
<meta name="twitter:value1" value="Max Rukomoynikov">
<title>Deploy Phoenix LiveView on Amazon LightSail</title>
<meta name="description" content="This is the first part of three in the series. There you will find creating foundation and answering to users.">

  <link rel="stylesheet" href="/assets/7b22a374.63ef34c0.css" />
<link rel="stylesheet" href="/assets/posts-deploy-rails-on-amazon-lightsail.c2f0ff4c.css" />
<link rel="stylesheet" href="/assets/4ad433b9.68f42f1c.css" />
<link rel="stylesheet" href="/assets/df9fe157.b2319824.css" />
<link rel="stylesheet" href="/assets/cb1b64c1.b69e1963.css" />
<link rel="stylesheet" href="/assets/13b71192.ccdf33b2.css" />
<link rel="stylesheet" href="/assets/41aa9c72.58b7ca84.css" /></head>
  <body class=" astro-IWK5W2YD">
    <div class="header astro-5PNHJ74F">
  <a href="/" class="logo astro-5PNHJ74F">
    Maxim<br class="astro-5PNHJ74F">Rukomoynikov
  </a>
  <div class="slogan astro-5PNHJ74F">
    I love to create. Developer and designer. Looking forward to make cool
    things.
  </div>
  <div class="links astro-5PNHJ74F">
    <a class="link astro-5PNHJ74F" href="/posts">blog</a>
    <a class="link astro-5PNHJ74F" href="/cases">design</a>
    <a class="link astro-5PNHJ74F" href="/cv">cv</a>
  </div>
</div>


    <div class="content astro-IWK5W2YD">
      <div class="hero-title astro-W7A2DVUK">
  <div class="hero-title__container astro-W7A2DVUK">
    <div class="hero-title__text-container astro-W7A2DVUK">
      <div class="hero-title__tag astro-W7A2DVUK">Elixir</div><div class="hero-title__tag astro-W7A2DVUK">Amazon Lightsail</div><div class="hero-title__tag astro-W7A2DVUK">Github Actions</div>
      <h2 class="hero-title__title astro-W7A2DVUK">
        Deploy Phoenix LiveView on Amazon LightSail
      </h2>
      
    </div>
  </div>
</div>

<div class="container--1200 astro-IBQ2E6SI">
  <div class="columns standard astro-QJA4LRDQ">
  <div class="col-1 astro-QJA4LRDQ"><p class="paragraph astro-XYZVYTE4">
  
        During this article i will lead you from basics of Lightsail to fully a furnished automatic CI\CD to Lightsail.
      
</p>

</div>
  <div class="col-2 astro-QJA4LRDQ"></div>
</div>

<h2 class=" astro-SJSIPHIP">What is Lightail in general?</h2>

<div class="columns standard astro-QJA4LRDQ">
  <div class="col-1 astro-QJA4LRDQ"><p class="paragraph astro-XYZVYTE4">
  
        Lightsail - new service from Amazon Cloud. Treat it like an younger brother of Amazon EC2. Though being a lighten version of EC2 it supports all essential tools. At the moment you can use: VPS, container services, hosted databases, load balancers and permanent storage and backups. Not bad, hah?
      
</p>

<p class="paragraph astro-XYZVYTE4">
  
        In this tutorial i will use <i class="astro-VMY7ZIVH">container service</i>

 what is someting similiar to Amazon Fargate + EC2. Container service allows to run Docker images. 
      
</p>

</div>
  <div class="col-2 astro-QJA4LRDQ"><ul class="links-list astro-3CWB35N2">
  <li class="astro-3CWB35N2">
        <a href="https://lightsail.aws.amazon.com" class="links-list__link astro-3CWB35N2">
          Amazon Lightsail
        </a>
      </li><li class="astro-3CWB35N2">
        <a href="https://www.youtube.com/watch?v=RhcR5LaRXIQ" class="links-list__link astro-3CWB35N2">
          Deploy your first containerized application (Youtube)
        </a>
      </li>
</ul>

</div>
</div>

<h2 class=" astro-SJSIPHIP">Phoenix LiveView application</h2>

<div class="columns standard astro-QJA4LRDQ">
  <div class="col-1 astro-QJA4LRDQ"><picture class="post__picture astro-HQAFPWCH">
	<source type="image/avif" srcset="/_image/assets/images/posts/deploy-elixir-app-on-lightsail/example_app_920x559.avif 920w,/_image/assets/images/posts/deploy-elixir-app-on-lightsail/example_app_1840x1118.avif 1840w" class="astro-HQAFPWCH" sizes="(max-width: 920px) 920w, 1840w"><source type="image/webp" srcset="/_image/assets/images/posts/deploy-elixir-app-on-lightsail/example_app_920x559.webp 920w,/_image/assets/images/posts/deploy-elixir-app-on-lightsail/example_app_1840x1118.webp 1840w" class="astro-HQAFPWCH" sizes="(max-width: 920px) 920w, 1840w"><source type="image/png" srcset="/_image/assets/images/posts/deploy-elixir-app-on-lightsail/example_app_920x559.png 920w,/_image/assets/images/posts/deploy-elixir-app-on-lightsail/example_app_1840x1118.png 1840w" class="astro-HQAFPWCH" sizes="(max-width: 920px) 920w, 1840w">
	<img width="1840" height="1118" src="/_image/assets/images/posts/deploy-elixir-app-on-lightsail/example_app_1840x1118.png" class="astro-HQAFPWCH" loading="lazy" decoding="async">
</picture>

<p class="paragraph astro-XYZVYTE4">
  
        To make this tale a bit simple i will not dive into creating something meaningfull. Rather we will create a basic boilerplate without Ecto. If in the future you will decide to add database this should not be a problem as LightSail supports managed databases as well.
      
</p>

<div class="code-snippet astro-RHIRIR7F">
  <div class="file-name"><img class="code-block__file-icon" src="/assets/console.4ea5677b.svg"/>Terminal</div>
  <pre class="astro-code" style="background-color: #FFFFFF; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #000000"></span></span>
<span class="line"><span style="color: #000000"># Scaffolding application</span></span>
<span class="line"><span style="color: #000000">mix phx.new github_dashboard --no-ecto</span></span>
<span class="line"><span style="color: #000000">      </span></span></code></pre>

</div>

<p class="paragraph astro-XYZVYTE4">
  
        Well done! Now it's time to make a commit and if you want to look at your new shiny project run local server <i class="astro-VMY7ZIVH">mix phx.server</i>

.
      
</p>

</div>
  <div class="col-2 astro-QJA4LRDQ"><ul class="links-list astro-3CWB35N2">
  <li class="astro-3CWB35N2">
        <a href="https://lightsail.aws.amazon.com" class="links-list__link astro-3CWB35N2">
          Example application on Github
        </a>
      </li>
</ul>

</div>
</div>

<h2 class=" astro-SJSIPHIP">Lightsail required setup</h2>

<div class="columns standard astro-QJA4LRDQ">
  <div class="col-1 astro-QJA4LRDQ"><picture class="post__picture astro-HQAFPWCH">
	<source type="image/avif" srcset="/_image/assets/images/posts/deploy-elixir-app-on-lightsail/light-sail-empty-container-service_920x502.avif 920w,/_image/assets/images/posts/deploy-elixir-app-on-lightsail/light-sail-empty-container-service_1840x1004.avif 1840w" class="astro-HQAFPWCH" sizes="(max-width: 920px) 920w, 1840w"><source type="image/webp" srcset="/_image/assets/images/posts/deploy-elixir-app-on-lightsail/light-sail-empty-container-service_920x502.webp 920w,/_image/assets/images/posts/deploy-elixir-app-on-lightsail/light-sail-empty-container-service_1840x1004.webp 1840w" class="astro-HQAFPWCH" sizes="(max-width: 920px) 920w, 1840w"><source type="image/png" srcset="/_image/assets/images/posts/deploy-elixir-app-on-lightsail/light-sail-empty-container-service_920x502.png 920w,/_image/assets/images/posts/deploy-elixir-app-on-lightsail/light-sail-empty-container-service_1840x1004.png 1840w" class="astro-HQAFPWCH" sizes="(max-width: 920px) 920w, 1840w">
	<img width="1840" height="1004" src="/_image/assets/images/posts/deploy-elixir-app-on-lightsail/light-sail-empty-container-service_1840x1004.png" class="astro-HQAFPWCH" loading="lazy" decoding="async">
</picture>

<p class="paragraph astro-XYZVYTE4">
  
        We are one step closer to the deployed application. Deployed on Lightsail. To make it possible first we need to create a container service and IAM settings.
      
</p>

<p class="paragraph astro-XYZVYTE4">
  
        Let's begin from container service. First sign in to AWS console and open Lightsail section. At the moment Amazon offers $10 "machine" to 3 months for free. Cheapest ($15) plan for managed database also is free for first 3 months. Why not to give it a try? Please create a container service. 
      
</p>

<picture class="post__picture astro-HQAFPWCH">
	<source type="image/avif" srcset="/_image/assets/images/posts/deploy-elixir-app-on-lightsail/pricing_920x350.avif 920w,/_image/assets/images/posts/deploy-elixir-app-on-lightsail/pricing_1840x699.avif 1840w" class="astro-HQAFPWCH" sizes="(max-width: 920px) 920w, 1840w"><source type="image/webp" srcset="/_image/assets/images/posts/deploy-elixir-app-on-lightsail/pricing_920x350.webp 920w,/_image/assets/images/posts/deploy-elixir-app-on-lightsail/pricing_1840x699.webp 1840w" class="astro-HQAFPWCH" sizes="(max-width: 920px) 920w, 1840w"><source type="image/png" srcset="/_image/assets/images/posts/deploy-elixir-app-on-lightsail/pricing_920x350.png 920w,/_image/assets/images/posts/deploy-elixir-app-on-lightsail/pricing_1840x699.png 1840w" class="astro-HQAFPWCH" sizes="(max-width: 920px) 920w, 1840w">
	<img width="1840" height="699" src="/_image/assets/images/posts/deploy-elixir-app-on-lightsail/pricing_1840x699.png" class="astro-HQAFPWCH" loading="lazy" decoding="async">
</picture>

<p class="paragraph astro-XYZVYTE4">
  
        On the creation screen: change region if needed, leave "Set up your first deployment" as is. In the field "Identify your service" enter desired name and save it somewhere. "Container service name" will be used later in CI settings.
      
</p>

</div>
  <div class="col-2 astro-QJA4LRDQ"></div>
</div>

<h3 class=" astro-SJSIPHIP">IAM roles</h3>

<div class="columns standard astro-QJA4LRDQ">
  <div class="col-1 astro-QJA4LRDQ"><p class="paragraph astro-XYZVYTE4">
  
        To be able interact with AWS API we need to create these two entities: policy, user. By default Amazon doesn't offer a policy to control Lightsail, but we are free to create it on our own.
      
</p>

<div class="code-snippet astro-RHIRIR7F">
  
  <pre class="astro-code" style="background-color: #FFFFFF; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"></span>
<span class="line"><span style="color: #000000">{</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0451A5">&quot;Version&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2012-10-17&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0451A5">&quot;Statement&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">    {</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0451A5">&quot;Sid&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;VisualEditor0&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0451A5">&quot;Effect&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;Allow&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0451A5">&quot;Action&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #A31515">&quot;lightsail:RegisterContainerImage&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #A31515">&quot;lightsail:CreateContainerServiceRegistryLogin&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #A31515">&quot;lightsail:CreateContainerServiceDeployment&quot;</span></span>
<span class="line"><span style="color: #000000">      ],</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0451A5">&quot;Resource&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;*&quot;</span></span>
<span class="line"><span style="color: #000000">    }</span></span>
<span class="line"><span style="color: #000000">  ]</span></span>
<span class="line"><span style="color: #000000">}</span></span>
<span class="line"><span style="color: #000000">      </span></span></code></pre>

</div>

</div>
  <div class="col-2 astro-QJA4LRDQ"></div>
</div>

<h2 class=" astro-SJSIPHIP">Docker setup</h2>

<div class="columns standard astro-QJA4LRDQ">
  <div class="col-1 astro-QJA4LRDQ"><p class="paragraph astro-XYZVYTE4">
  
        Lightsail will run container we point to. So, in order to create docker container first Dockerfile is required. Using this file Github CI will build image and push the image to Lightsail image's container.
      
</p>

<div class="code-snippet astro-RHIRIR7F">
  <div class="file-name"><img class="code-block__file-icon" src="/assets/file-2.ad06406a.svg"/>Dockerfile</div>
  <pre class="astro-code" style="background-color: #FFFFFF; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"></span>
<span class="line"><span style="color: #008000"># -----------------</span></span>
<span class="line"><span style="color: #008000"># BASE</span></span>
<span class="line"><span style="color: #008000"># -----------------</span></span>
<span class="line"><span style="color: #0000FF">FROM</span><span style="color: #000000"> elixir:alpine </span><span style="color: #0000FF">AS</span><span style="color: #000000"> base</span></span>
<span class="line"><span style="color: #0000FF">WORKDIR</span><span style="color: #000000"> /app</span></span>
<span class="line"><span style="color: #0000FF">RUN</span><span style="color: #000000"> mix do local.hex --force, local.rebar --force</span></span>
<span class="line"><span style="color: #0000FF">RUN</span><span style="color: #000000"> apk add npm inotify-tools</span></span>
<span class="line"></span>
<span class="line"><span style="color: #008000"># -----------------</span></span>
<span class="line"><span style="color: #008000"># BUILD</span></span>
<span class="line"><span style="color: #008000"># -----------------</span></span>
<span class="line"><span style="color: #0000FF">FROM</span><span style="color: #000000"> base </span><span style="color: #0000FF">AS</span><span style="color: #000000"> build</span></span>
<span class="line"><span style="color: #0000FF">RUN</span><span style="color: #000000"> apk add curl bash git</span></span>
<span class="line"><span style="color: #0000FF">ARG</span><span style="color: #000000"> MIX_ENV=prod</span></span>
<span class="line"><span style="color: #0000FF">ENV</span><span style="color: #000000"> MIX_ENV=$MIX_ENV</span></span>
<span class="line"><span style="color: #0000FF">COPY</span><span style="color: #000000"> . ./</span></span>
<span class="line"><span style="color: #008000"># install application</span></span>
<span class="line"><span style="color: #0000FF">RUN</span><span style="color: #000000"> mix do deps.get, compile</span></span>
<span class="line"></span>
<span class="line"><span style="color: #008000"># -----------------</span></span>
<span class="line"><span style="color: #008000"># RELEASE</span></span>
<span class="line"><span style="color: #008000"># -----------------</span></span>
<span class="line"><span style="color: #0000FF">FROM</span><span style="color: #000000"> build </span><span style="color: #0000FF">AS</span><span style="color: #000000"> release</span></span>
<span class="line"><span style="color: #0000FF">ARG</span><span style="color: #000000"> MIX_ENV=prod</span></span>
<span class="line"><span style="color: #008000"># digests and compresses static files</span></span>
<span class="line"><span style="color: #0000FF">RUN</span><span style="color: #000000"> mix assets.deploy</span></span>
<span class="line"><span style="color: #008000"># generate release executable</span></span>
<span class="line"><span style="color: #0000FF">RUN</span><span style="color: #000000"> mix phx.gen.release</span></span>
<span class="line"><span style="color: #0000FF">RUN</span><span style="color: #000000"> mix release</span></span>
<span class="line"></span>
<span class="line"><span style="color: #008000"># -----------------</span></span>
<span class="line"><span style="color: #008000"># PRODUCTION</span></span>
<span class="line"><span style="color: #008000"># -----------------</span></span>
<span class="line"><span style="color: #0000FF">FROM</span><span style="color: #000000"> elixir:alpine</span></span>
<span class="line"><span style="color: #0000FF">WORKDIR</span><span style="color: #000000"> /app</span></span>
<span class="line"><span style="color: #0000FF">ARG</span><span style="color: #000000"> MIX_ENV=prod</span></span>
<span class="line"></span>
<span class="line"><span style="color: #008000"># install dependencies</span></span>
<span class="line"><span style="color: #0000FF">RUN</span><span style="color: #000000"> apk add ncurses-libs curl</span></span>
<span class="line"><span style="color: #0000FF">COPY</span><span style="color: #000000"> --from=release /app/_build/prod/rel/github_dashboard ./</span></span>
<span class="line"></span>
<span class="line"><span style="color: #008000"># start application</span></span>
<span class="line"><span style="color: #0000FF">CMD</span><span style="color: #000000"> [</span><span style="color: #A31515">&quot;bin/server&quot;</span><span style="color: #000000">, </span><span style="color: #A31515">&quot;start&quot;</span><span style="color: #000000">]</span></span>
<span class="line"><span style="color: #000000">      </span></span></code></pre>

</div>

</div>
  <div class="col-2 astro-QJA4LRDQ"></div>
</div>

<h2 class=" astro-SJSIPHIP">Github Actions to test and deploy</h2>

<div class="columns standard astro-QJA4LRDQ">
  <div class="col-1 astro-QJA4LRDQ"><p class="paragraph astro-XYZVYTE4">
  
        Heya! We are almost there. Let's setup CI pipeline to test our super-duper app. 
      
</p>

<div class="code-snippet astro-RHIRIR7F">
  <div class="file-name"><img class="code-block__file-icon" src="/assets/file-2.ad06406a.svg"/>.github/workflows/ci.yml</div>
  <pre class="astro-code" style="background-color: #FFFFFF; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"></span>
<span class="line"><span style="color: #800000">name</span><span style="color: #000000">: </span><span style="color: #0000FF">Elixir CI</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0000FF">on</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #800000">push</span><span style="color: #000000">:</span></span>
<span class="line"></span>
<span class="line"><span style="color: #800000">permissions</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #800000">contents</span><span style="color: #000000">: </span><span style="color: #0000FF">read</span></span>
<span class="line"></span>
<span class="line"><span style="color: #800000">env</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #800000">CONTAINER_SERVICE_NAME</span><span style="color: #000000">: </span><span style="color: #0000FF">&lt;container service name&gt;</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #800000">AWS_REGION</span><span style="color: #000000">: </span><span style="color: #0000FF">&lt;aws region&gt;</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #800000">DOCKER_TAG</span><span style="color: #000000">: </span><span style="color: #0000FF">&lt;some name to tag your docker images in Lightsail hub&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #800000">jobs</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #800000">build</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #800000">name</span><span style="color: #000000">: </span><span style="color: #0000FF">Build and test</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #800000">runs-on</span><span style="color: #000000">: </span><span style="color: #0000FF">ubuntu-latest</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #800000">steps</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">    - </span><span style="color: #800000">uses</span><span style="color: #000000">: </span><span style="color: #0000FF">actions/checkout@v3</span></span>
<span class="line"><span style="color: #000000">    - </span><span style="color: #800000">name</span><span style="color: #000000">: </span><span style="color: #0000FF">Set up Elixir</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #800000">uses</span><span style="color: #000000">: </span><span style="color: #0000FF">erlef/setup-beam@988e02bfe678367a02564f65ca2e37726dc0268f</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #800000">with</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #800000">elixir-version</span><span style="color: #000000">: </span><span style="color: #0000FF">&#39;1.12.3&#39;</span><span style="color: #000000"> </span><span style="color: #008000"># Define the elixir version [required]</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #800000">otp-version</span><span style="color: #000000">: </span><span style="color: #0000FF">&#39;24.1&#39;</span><span style="color: #000000"> </span><span style="color: #008000"># Define the OTP version [required]</span></span>
<span class="line"><span style="color: #000000">    - </span><span style="color: #800000">name</span><span style="color: #000000">: </span><span style="color: #0000FF">Restore dependencies cache</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #800000">uses</span><span style="color: #000000">: </span><span style="color: #0000FF">actions/cache@v3</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #800000">with</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #800000">path</span><span style="color: #000000">: </span><span style="color: #0000FF">deps</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #800000">key</span><span style="color: #000000">: </span><span style="color: #0000FF">${{ runner.os }}-mix-${{ hashFiles(&#39;**/mix.lock&#39;) }}</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #800000">restore-keys</span><span style="color: #000000">: </span><span style="color: #0000FF">${{ runner.os }}-mix-</span></span>
<span class="line"><span style="color: #000000">    - </span><span style="color: #800000">name</span><span style="color: #000000">: </span><span style="color: #0000FF">Install dependencies</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #800000">run</span><span style="color: #000000">: </span><span style="color: #0000FF">mix deps.get</span></span>
<span class="line"><span style="color: #000000">    - </span><span style="color: #800000">name</span><span style="color: #000000">: </span><span style="color: #0000FF">Run tests</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #800000">run</span><span style="color: #000000">: </span><span style="color: #0000FF">mix test</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #800000">deploy</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #800000">name</span><span style="color: #000000">: </span><span style="color: #0000FF">Deploy to Lightsail</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #800000">runs-on</span><span style="color: #000000">: </span><span style="color: #0000FF">ubuntu-latest</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #800000">steps</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">    - </span><span style="color: #800000">uses</span><span style="color: #000000">: </span><span style="color: #0000FF">actions/checkout@v3</span></span>
<span class="line"><span style="color: #000000">    - </span><span style="color: #800000">name</span><span style="color: #000000">: </span><span style="color: #0000FF">Build docker container</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #800000">run</span><span style="color: #000000">: </span><span style="color: #AF00DB">|</span></span>
<span class="line"><span style="color: #0000FF">        docker build . -t $DOCKER_TAG</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #008000"># By default AWS cli is available in Github Actions environment, but not Lightsail cli. So we need to install it manualy.</span></span>
<span class="line"><span style="color: #000000">    - </span><span style="color: #800000">name</span><span style="color: #000000">: </span><span style="color: #0000FF">Install LightSail AWS CLI plugin</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #800000">run</span><span style="color: #000000">: </span><span style="color: #AF00DB">|</span></span>
<span class="line"><span style="color: #0000FF">        curl &quot;https://s3.us-west-2.amazonaws.com/lightsailctl/latest/linux-amd64/lightsailctl&quot; -o &quot;/usr/local/bin/lightsailctl&quot;</span></span>
<span class="line"><span style="color: #0000FF">        sudo chmod +x /usr/local/bin/lightsailctl</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #008000"># Please add you AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY into your Github Repo.</span></span>
<span class="line"><span style="color: #000000">    - </span><span style="color: #800000">name</span><span style="color: #000000">: </span><span style="color: #0000FF">Configure AWS Credentials</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #800000">uses</span><span style="color: #000000">: </span><span style="color: #0000FF">aws-actions/configure-aws-credentials@v1</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #800000">with</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #800000">aws-access-key-id</span><span style="color: #000000">: </span><span style="color: #0000FF">${{ secrets.AWS_ACCESS_KEY_ID }}</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #800000">aws-secret-access-key</span><span style="color: #000000">: </span><span style="color: #0000FF">${{ secrets.AWS_SECRET_ACCESS_KEY }}</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #800000">aws-region</span><span style="color: #000000">: </span><span style="color: #0000FF">${{ env.AWS_REGION }}</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">    - </span><span style="color: #800000">name</span><span style="color: #000000">: </span><span style="color: #0000FF">Push new version to LightSail</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #800000">run</span><span style="color: #000000">: </span><span style="color: #0000FF">aws lightsail push-container-image --region $AWS_REGION --service-name $CONTAINER_SERVICE_NAME --label $DOCKER_TAG --image $DOCKER_TAG:latest</span></span>
<span class="line"><span style="color: #000000">    - </span><span style="color: #800000">name</span><span style="color: #000000">: </span><span style="color: #0000FF">Deploy pushed container</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #800000">run</span><span style="color: #000000">:  </span><span style="color: #0000FF">aws lightsail create-container-service-deployment --service-name $CONTAINER_SERVICE_NAME --containers file://lightsail/containers.json --public-endpoint file://lightsail/public-endpoint.json</span></span>
<span class="line"></span>
<span class="line"></span></code></pre>

</div>

</div>
  <div class="col-2 astro-QJA4LRDQ"></div>
</div>

<a href="https://github.com/Rukomoynikov/act_as_api_client" class="github-repo astro-MGRYT25X">
  <div class="github-repo__title-container astro-MGRYT25X">
    <img class="github-repo__image astro-MGRYT25X" src="/assets/octicon.b3a7a685.svg">
    act_as_api_client 
    <!-- <GithubStars 
      client:load 
      repo='Rukomoynikov/act_as_api_client' /> -->
  </div>
  <div class="github-repo__description astro-MGRYT25X">
    Templates for popular API&#39;s and reliable way to create your own clients. At the moment it supports Github’s API, Authorize.net
  </div>
</a>



</div>


    </div>
  
</body></html>