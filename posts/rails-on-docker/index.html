<!DOCTYPE html>
<html lang="en" class="astro-IWK5W2YD">
  <head>
    <script defer data-domain="rukomoynikov.ru" src="https://plausible.io/js/plausible.js"></script>


<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<link rel="icon" type="image/x-icon" href="/favicon/favicon.ico">
<link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
<link rel="manifest" href="/favicon/site.webmanifest">
<link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#5bbad5">

<link rel="canonical" href="https://rukomoynikov.ru/posts/rails-on-docker/">
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="How to generate Rails app and run it without installing ruby locally">
<meta property="og:url" content="https://rukomoynikov.ru/posts/rails-on-docker/">
<meta property="og:image" content="https://rukomoynikov.ru/_image/assets/images/posts/rails-on-docker/facebook-share_2400x1260.jpg">
<meta property="og:description" content="In internet plenty of articles about Dockerizing existing application. But, what if you don't have installed ruby locally and need to generate new app.">
<meta property="og:site_name" content="Max Rukomoynikov's site">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@rukomoynikov">
<meta name="twitter:creator" content="@rukomoynikov">
<meta name="twitter:title" content="How to generate Rails app and run it without installing ruby locally">
<meta name="twitter:image" content="https://rukomoynikov.ru/_image/assets/images/posts/rails-on-docker/facebook-share_2400x1260.jpg">
<meta name="twitter:description" content="In internet plenty of articles about Dockerizing existing application. But, what if you don't have installed ruby locally and need to generate new app.">
<meta name="twitter:label1" value="Author">
<meta name="twitter:value1" value="Max Rukomoynikov">
<title>How to generate Rails app and run it without installing ruby locally</title>
<meta name="description" content="In internet plenty of articles about Dockerizing existing application. But, what if you don't have installed ruby locally and need to generate new app.">

  <link rel="stylesheet" href="/assets/7b22a374.63ef34c0.css" />
<link rel="stylesheet" href="/assets/4ad433b9.68f42f1c.css" />
<link rel="stylesheet" href="/assets/df9fe157.b2319824.css" />
<link rel="stylesheet" href="/assets/cb1b64c1.b69e1963.css" />
<link rel="stylesheet" href="/assets/13b71192.ccdf33b2.css" />
<link rel="stylesheet" href="/assets/41aa9c72.58b7ca84.css" /></head>
  <body class=" astro-IWK5W2YD">
    <div class="header astro-5PNHJ74F">
  <a href="/" class="logo astro-5PNHJ74F">
    Maxim<br class="astro-5PNHJ74F">Rukomoynikov
  </a>
  <div class="slogan astro-5PNHJ74F">
    I love to create. Developer and designer. Looking forward to make cool
    things.
  </div>
  <div class="links astro-5PNHJ74F">
    <a class="link astro-5PNHJ74F" href="/posts">blog</a>
    <a class="link astro-5PNHJ74F" href="/cases">design</a>
    <a class="link astro-5PNHJ74F" href="/cv">cv</a>
  </div>
</div>


    <div class="content astro-IWK5W2YD">
      <div class="hero-title astro-W7A2DVUK">
  <div class="hero-title__container astro-W7A2DVUK">
    <div class="hero-title__text-container astro-W7A2DVUK">
      <div class="hero-title__tag astro-W7A2DVUK">Ruby</div><div class="hero-title__tag astro-W7A2DVUK">Docker</div>
      <h2 class="hero-title__title astro-W7A2DVUK">
        How to generate Rails app and run it without installing ruby locally
      </h2>
      <div class="hero-title__subtitle">In internet plenty of articles about Dockerizing existing application. But, what if you don't have installed ruby locally and need to generate new app.</div>
    </div>
  </div>
</div>

<div class="container--1200 astro-IBQ2E6SI">
  <h2 class=" astro-SJSIPHIP">Why Docker?</h2>

<div class="columns standard astro-QJA4LRDQ">
  <div class="col-1 astro-QJA4LRDQ"><p class="paragraph astro-XYZVYTE4">
  
        It has always been easier to supply the necessary tools locally. If you need to have multiple versions, then rvm or nvm solve the problem. Then came Docker. Until this year, I had successfully managed to avoid it. On projects where the guys worked with Docker, I instead installed everything locally. But, I thought that enough fighting and it's time to try to live with the idea of "docker for everything". It's simply time to admit either i work using Docker or i don't work at all.
      
</p>

</div>
  <div class="col-2 astro-QJA4LRDQ"></div>
</div>

<h2 class=" astro-SJSIPHIP">Generating Ruby on Rails application</h2>

<div class="columns standard astro-QJA4LRDQ">
  <div class="col-1 astro-QJA4LRDQ"><p class="paragraph astro-XYZVYTE4">
  
        Well I don't have ruby installed locally. And I need to generate a new Rails application or experiment in IRB.
      
</p>

</div>
  <div class="col-2 astro-QJA4LRDQ"></div>
</div>

<div class="columns standard astro-QJA4LRDQ">
  <div class="col-1 astro-QJA4LRDQ"><p class="paragraph astro-XYZVYTE4">
  
        The first thing I did was look at the official Rails image. It turned out to be deprecated, and the authors suggested Ruby as a replacement.Using Ruby image, I was unable to generate a Rails application, so Imade my own Docker image.
      
</p>

</div>
  <div class="col-2 astro-QJA4LRDQ"></div>
</div>

<div class="columns standard astro-QJA4LRDQ">
  <div class="col-1 astro-QJA4LRDQ"><div class="code-snippet astro-RHIRIR7F">
  
  <pre class="astro-code" style="background-color: #FFFFFF; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"></span>
<span class="line"><span style="color: #0000FF">FROM</span><span style="color: #000000"> debian:bullseye</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0000FF">WORKDIR</span><span style="color: #000000"> /app</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0000FF">ARG</span><span style="color: #000000"> ruby_version=2.7.1</span></span>
<span class="line"><span style="color: #0000FF">ARG</span><span style="color: #000000"> PG_MAJOR=13</span></span>
<span class="line"><span style="color: #0000FF">ARG</span><span style="color: #000000"> NODE_MAJOR=14</span></span>
<span class="line"></span>
<span class="line"><span style="color: #008000"># Installing general packages</span></span>
<span class="line"><span style="color: #0000FF">RUN</span><span style="color: #000000"> apt update \</span></span>
<span class="line"><span style="color: #000000">  &amp;&amp; apt upgrade -y \</span></span>
<span class="line"><span style="color: #000000">  &amp;&amp; apt install libpq-dev postgresql-client-$PG_MAJOR gnupg2 git wget curl vim build-essential libssl-dev zlib1g-dev libyaml-dev libffi-dev -y</span></span>
<span class="line"></span>
<span class="line"><span style="color: #008000"># Installing rbenv and ruby</span></span>
<span class="line"><span style="color: #0000FF">RUN</span><span style="color: #000000"> apt install rbenv -y \</span></span>
<span class="line"><span style="color: #000000">  &amp;&amp; echo </span><span style="color: #A31515">&#39;eval &quot;$(rbenv init -)&quot;&#39;</span><span style="color: #000000"> &gt;&gt; ~/.bashrc \</span></span>
<span class="line"><span style="color: #000000">  &amp;&amp; rbenv install $ruby_version \</span></span>
<span class="line"><span style="color: #000000">    &amp;&amp; rbenv global $ruby_version \</span></span>
<span class="line"><span style="color: #000000">  &amp;&amp; eval </span><span style="color: #A31515">&quot;$(rbenv init -)&quot;</span><span style="color: #000000"> \</span></span>
<span class="line"><span style="color: #000000">  &amp;&amp; gem install rails</span></span>
<span class="line"></span>
<span class="line"><span style="color: #008000">#Installing node and yarn</span></span>
<span class="line"><span style="color: #0000FF">RUN</span><span style="color: #000000"> curl -sL https://deb.nodesource.com/setup_$NODE_MAJOR.x | bash - \</span></span>
<span class="line"><span style="color: #000000">  &amp;&amp; apt install nodejs \</span></span>
<span class="line"><span style="color: #000000">  &amp;&amp; npm i -g yarn</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0000FF">ENV</span><span style="color: #000000"> PATH /root/.rbenv/versions/$ruby_version/bin/:/root/.rbenv/shims:$PATH</span></span>
<span class="line"><span style="color: #000000">      </span></span></code></pre>

</div>

</div>
  <div class="col-2 astro-QJA4LRDQ"><ul class="links-list astro-3CWB35N2">
  <li class="astro-3CWB35N2">
        <a href="https://hub.docker.com/repository/docker/rukomoynikov/rails/general" class="links-list__link astro-3CWB35N2">
          Image on Docker Hub
        </a>
      </li>
</ul>

</div>
</div>

<h2 class=" astro-SJSIPHIP">Using the image</h2>

<div class="columns standard astro-QJA4LRDQ">
  <div class="col-1 astro-QJA4LRDQ"><p class="paragraph astro-XYZVYTE4">
  
        The following command will generate a new Rails application in the current folder and install required gems in the gems folder. As you know, a container cannot change its content after it has been built.Therefore, all application files and gems will be stored on the host machine.
      
</p>

</div>
  <div class="col-2 astro-QJA4LRDQ"></div>
</div>

<div class="columns standard astro-QJA4LRDQ">
  <div class="col-1 astro-QJA4LRDQ"><div class="code-snippet astro-RHIRIR7F">
  
  <pre class="astro-code" style="background-color: #FFFFFF; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #000000"></span></span>
<span class="line"><span style="color: #000000">        docker run --rm -v /$(pwd):/app rukomoynikov/rails rails new .</span></span>
<span class="line"><span style="color: #000000">      </span></span></code></pre>

</div>

</div>
  <div class="col-2 astro-QJA4LRDQ"></div>
</div>

<div class="columns standard astro-QJA4LRDQ">
  <div class="col-1 astro-QJA4LRDQ"><p class="paragraph astro-XYZVYTE4">
  
        Launching the application is not much more difficult. But, in a simple form, it will only work if you use the sqlite database.
      
</p>

</div>
  <div class="col-2 astro-QJA4LRDQ"></div>
</div>

<div class="columns standard astro-QJA4LRDQ">
  <div class="col-1 astro-QJA4LRDQ"><div class="code-snippet astro-RHIRIR7F">
  
  <pre class="astro-code" style="background-color: #FFFFFF; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #000000"></span></span>
<span class="line"><span style="color: #000000">        docker run --rm -it -p 3000:3000 -v /$(pwd):/app rukomoynikov/rails rails s -b 0.0.0.0</span></span>
<span class="line"><span style="color: #000000">      </span></span></code></pre>

</div>

</div>
  <div class="col-2 astro-QJA4LRDQ"></div>
</div>

<div class="columns standard astro-QJA4LRDQ">
  <div class="col-1 astro-QJA4LRDQ"><p class="paragraph astro-XYZVYTE4">
  
        Running IRB. Or you can enter console and run ruby files from local machine.
      
</p>

</div>
  <div class="col-2 astro-QJA4LRDQ"></div>
</div>

<div class="columns standard astro-QJA4LRDQ">
  <div class="col-1 astro-QJA4LRDQ"><div class="code-snippet astro-RHIRIR7F">
  
  <pre class="astro-code" style="background-color: #FFFFFF; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #000000"></span></span>
<span class="line"><span style="color: #000000">        docker run --rm -it -p 3000:3000 -v /$(pwd):/app rukomoynikov/rails bash</span></span>
<span class="line"><span style="color: #000000">      </span></span></code></pre>

</div>

</div>
  <div class="col-2 astro-QJA4LRDQ"></div>
</div>

<div class="columns standard astro-QJA4LRDQ">
  <div class="col-1 astro-QJA4LRDQ"><picture class="post__picture astro-HQAFPWCH">
	<source type="image/avif" srcset="/_image/assets/images/posts/rails-on-docker/rails-basic-app/rails-basic-app_920x535.avif 920w,/_image/assets/images/posts/rails-on-docker/rails-basic-app/rails-basic-app_1840x1069.avif 1840w" class="astro-HQAFPWCH" sizes="(max-width: 920px) 920w, 1840w"><source type="image/webp" srcset="/_image/assets/images/posts/rails-on-docker/rails-basic-app/rails-basic-app_920x535.webp 920w,/_image/assets/images/posts/rails-on-docker/rails-basic-app/rails-basic-app_1840x1069.webp 1840w" class="astro-HQAFPWCH" sizes="(max-width: 920px) 920w, 1840w"><source type="image/png" srcset="/_image/assets/images/posts/rails-on-docker/rails-basic-app/rails-basic-app_920x535.png 920w,/_image/assets/images/posts/rails-on-docker/rails-basic-app/rails-basic-app_1840x1069.png 1840w" class="astro-HQAFPWCH" sizes="(max-width: 920px) 920w, 1840w">
	<img width="1840" height="1069" src="/_image/assets/images/posts/rails-on-docker/rails-basic-app/rails-basic-app_1840x1069.png" class="astro-HQAFPWCH" loading="lazy" decoding="async">
</picture>

</div>
  <div class="col-2 astro-QJA4LRDQ"></div>
</div>

<h2 class=" astro-SJSIPHIP">What's next?</h2>

<div class="columns standard astro-QJA4LRDQ">
  <div class="col-1 astro-QJA4LRDQ"><p class="paragraph astro-XYZVYTE4">
  
        Above you saw an example of basic Rails application used SQLite. In order to use Postgresql and Webpacker you need something more complicated than simple Dockerfile. You need docker-compose. There you will be able to separate application into a ruby service, and the client service.
      
</p>

</div>
  <div class="col-2 astro-QJA4LRDQ"></div>
</div>

<div class="columns standard astro-QJA4LRDQ">
  <div class="col-1 astro-QJA4LRDQ"><p class="paragraph astro-XYZVYTE4">
  Here is example of docker-compose.yml
</p>

</div>
  <div class="col-2 astro-QJA4LRDQ"></div>
</div>

<div class="columns standard astro-QJA4LRDQ">
  <div class="col-1 astro-QJA4LRDQ"><div class="code-snippet astro-RHIRIR7F">
  
  <pre class="astro-code" style="background-color: #FFFFFF; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"></span>
<span class="line"><span style="color: #800000">services</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #800000">web</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #800000">image</span><span style="color: #000000">: </span><span style="color: #0000FF">rukomoynikov/rails:2.7.1</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #800000">volumes</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">      - </span><span style="color: #0000FF">./:/app</span></span>
<span class="line"><span style="color: #000000">      - </span><span style="color: #0000FF">rails_cache:/app/tmp/cache</span></span>
<span class="line"><span style="color: #000000">      - </span><span style="color: #0000FF">bundle:/usr/local/bundle</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #800000">ports</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">      - </span><span style="color: #0000FF">3000:3000</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #800000">tmpfs</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">      - </span><span style="color: #0000FF">/tmp</span></span>
<span class="line"><span style="color: #000000">      - </span><span style="color: #0000FF">/app/tmp/pids</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #800000">depends_on</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #800000">postgres</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #800000">condition</span><span style="color: #000000">: </span><span style="color: #0000FF">service_healthy</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #800000">redis</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #800000">condition</span><span style="color: #000000">: </span><span style="color: #0000FF">service_healthy</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #800000">command</span><span style="color: #000000">: </span><span style="color: #0000FF">bundle exec rails server -b 0.0.0.0</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #800000">client</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #800000">image</span><span style="color: #000000">: </span><span style="color: #0000FF">rukomoynikov/rails:2.7.1</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #800000">command</span><span style="color: #000000">: </span><span style="color: #0000FF">yarn run build -w</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #800000">ports</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">      - </span><span style="color: #0000FF">&#39;3035:3035&#39;</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #800000">volumes</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">      - </span><span style="color: #0000FF">./:/app:cached</span></span>
<span class="line"><span style="color: #000000">      - </span><span style="color: #0000FF">bundle:/usr/local/bundle</span></span>
<span class="line"><span style="color: #000000">      - </span><span style="color: #0000FF">node_modules:/app/node_modules</span></span>
<span class="line"><span style="color: #000000">      - </span><span style="color: #0000FF">packs:/app/public/packs</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #800000">environment</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #800000">WEBPACKER_DEV_SERVER_HOST</span><span style="color: #000000">: </span><span style="color: #098658">0.0.0.0</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #800000">postgres</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #800000">image</span><span style="color: #000000">: </span><span style="color: #0000FF">postgres:13</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #800000">volumes</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">      - </span><span style="color: #0000FF">postgres:/var/lib/postgresql/data</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #800000">environment</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #800000">PSQL_HISTFILE</span><span style="color: #000000">: </span><span style="color: #0000FF">/root/log/.psql_history</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #800000">POSTGRES_PASSWORD</span><span style="color: #000000">: </span><span style="color: #0000FF">postgres</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #800000">ports</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">      - </span><span style="color: #098658">5432</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #800000">healthcheck</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #800000">test</span><span style="color: #000000">: </span><span style="color: #0000FF">pg_isready -U postgres -h 127.0.0.1</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #800000">interval</span><span style="color: #000000">: </span><span style="color: #0000FF">5s</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #800000">redis</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #800000">image</span><span style="color: #000000">: </span><span style="color: #0000FF">redis:3.2-alpine</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #800000">volumes</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">      - </span><span style="color: #0000FF">redis:/data</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #800000">ports</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">      - </span><span style="color: #098658">6379</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #800000">healthcheck</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #800000">test</span><span style="color: #000000">: </span><span style="color: #0000FF">redis-cli ping</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #800000">interval</span><span style="color: #000000">: </span><span style="color: #0000FF">1s</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #800000">timeout</span><span style="color: #000000">: </span><span style="color: #0000FF">3s</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #800000">retries</span><span style="color: #000000">: </span><span style="color: #098658">30</span></span>
<span class="line"></span>
<span class="line"><span style="color: #800000">volumes</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #800000">postgres</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #800000">redis</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #800000">bundle</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #800000">rails_cache</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #800000">node_modules</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #800000">packs</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">      </span></span></code></pre>

</div>

</div>
  <div class="col-2 astro-QJA4LRDQ"><ul class="links-list astro-3CWB35N2">
  <li class="astro-3CWB35N2">
        <a href="https://evilmartians.com/chronicles/ruby-on-whales-docker-for-ruby-rails-development" class="links-list__link astro-3CWB35N2">
          Heavily inspired by Evil Martians article
        </a>
      </li>
</ul>

</div>
</div>


</div>


    </div>
  
</body></html>