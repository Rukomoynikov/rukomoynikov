<!doctype html>
<html data-n-head-ssr lang="en" data-n-head="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>Hot to generate Rails app and run it without installing ruby locally</title><meta data-n-head="ssr" charset="utf-8"><meta data-n-head="ssr" name="viewport" content="width=device-width"><meta data-n-head="ssr" data-hid="description" name="description" content=""><meta data-n-head="ssr" name="format-detection" content="telephone=no"><meta data-n-head="ssr" data-hid="twitter:card" name="twitter:card" content="summary_large_image"><meta data-n-head="ssr" data-hid="twitter:title" name="twitter:title" content="Hot to generate Rails app and run it without installing ruby locally"><meta data-n-head="ssr" data-hid="twitter:description" name="twitter:description" content="Docker image for generation rails application or play with ruby"><meta data-n-head="ssr" data-hid="og:title" property="og:title" content="Hot to generate Rails app and run it without installing ruby locally"><meta data-n-head="ssr" data-hid="og:description" property="og:description" content="Docker image for generation rails application or play with ruby"><meta data-n-head="ssr" data-hid="og:image" property="og:image" content="https://rukomoynikov.ru/_nuxt/img/facebook-share.f96d9f6.jpg"><meta data-n-head="ssr" data-hid="og:image:secure_url" property="og:image:secure_url" content="https://rukomoynikov.ru/_nuxt/img/facebook-share.f96d9f6.jpg"><meta data-n-head="ssr" data-hid="og:image:alt" property="og:image:alt" content="Hot to generate Rails app and run it without installing ruby locally"><link data-n-head="ssr" rel="icon" type="image/x-icon" href="/favicon/favicon.ico"><link data-n-head="ssr" rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png"><link data-n-head="ssr" rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png"><link data-n-head="ssr" rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png"><link data-n-head="ssr" rel="manifest" href="/favicon/site.webmanifest"><link data-n-head="ssr" rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#5bbad5"><script data-n-head="ssr" src="https://plausible.io/js/plausible.js" defer data-domain="rukomoynikov.ru"></script><link rel="preload" href="/_nuxt/0f769b2.js" as="script"><link rel="preload" href="/_nuxt/6e86502.js" as="script"><link rel="preload" href="/_nuxt/10b8bef.js" as="script"><link rel="preload" href="/_nuxt/221fbe7.js" as="script"><link rel="preload" href="/_nuxt/549224a.js" as="script"><style data-vue-ssr-id="42838bd4:0 ab8fb0f8:0 43dee4e4:0 fa7ff0ca:0 59ee5bee:0 5edaacb0:0 10f5b334:0 07a0ed3c:0 76c4480e:0 f3cd4790:0 106855a6:0 0c132c00:0 d8273f98:0">@font-face{font-family:"IBM Plex Sans";src:url(/_nuxt/fonts/IBMPlexSans-ExtraLightItalic.19fadbb.woff2) format("woff2"),url(/_nuxt/fonts/IBMPlexSans-ExtraLightItalic.0b4a9f0.woff) format("woff");font-weight:200;font-style:italic;font-display:swap}@font-face{font-family:"IBM Plex Sans";src:url(/_nuxt/fonts/IBMPlexSans-BoldItalic.8382e18.woff2) format("woff2"),url(/_nuxt/fonts/IBMPlexSans-BoldItalic.e9dbc59.woff) format("woff");font-weight:700;font-style:italic;font-display:swap}@font-face{font-family:"IBM Plex Sans";src:url(/_nuxt/fonts/IBMPlexSans-Italic.9419ba2.woff2) format("woff2"),url(/_nuxt/fonts/IBMPlexSans-Italic.23eee9c.woff) format("woff");font-weight:400;font-style:italic;font-display:swap}@font-face{font-family:"IBM Plex Sans";src:url(/_nuxt/fonts/IBMPlexSans-Bold.92e83f7.woff2) format("woff2"),url(/_nuxt/fonts/IBMPlexSans-Bold.be75364.woff) format("woff");font-weight:700;font-style:normal;font-display:swap}@font-face{font-family:"IBM Plex Sans";src:url(/_nuxt/fonts/IBMPlexSans-ExtraLight.b494911.woff2) format("woff2"),url(/_nuxt/fonts/IBMPlexSans-ExtraLight.c7f9c6f.woff) format("woff");font-weight:200;font-style:normal;font-display:swap}@font-face{font-family:"IBM Plex Sans";src:url(/_nuxt/fonts/IBMPlexSans-SemiBold.4d4db3a.woff2) format("woff2"),url(/_nuxt/fonts/IBMPlexSans-SemiBold.54dbdeb.woff) format("woff");font-weight:600;font-style:normal;font-display:swap}@font-face{font-family:"IBM Plex Sans";src:url(/_nuxt/fonts/IBMPlexSans-Medium.c438300.woff2) format("woff2"),url(/_nuxt/fonts/IBMPlexSans-Medium.c8cb78a.woff) format("woff");font-weight:500;font-style:normal;font-display:swap}@font-face{font-family:"IBM Plex Sans";src:url(/_nuxt/fonts/IBMPlexSans-LightItalic.cb534a4.woff2) format("woff2"),url(/_nuxt/fonts/IBMPlexSans-LightItalic.2fdf067.woff) format("woff");font-weight:300;font-style:italic;font-display:swap}@font-face{font-family:"IBM Plex Sans";src:url(/_nuxt/fonts/IBMPlexSans-MediumItalic.a4a6f59.woff2) format("woff2"),url(/_nuxt/fonts/IBMPlexSans-MediumItalic.3e90435.woff) format("woff");font-weight:500;font-style:italic;font-display:swap}@font-face{font-family:"IBM Plex Sans";src:url(/_nuxt/fonts/IBMPlexSans-ThinItalic.236c1c6.woff2) format("woff2"),url(/_nuxt/fonts/IBMPlexSans-ThinItalic.550931c.woff) format("woff");font-weight:100;font-style:italic;font-display:swap}@font-face{font-family:"IBM Plex Sans";src:url(/_nuxt/fonts/IBMPlexSans-Light.94824c3.woff2) format("woff2"),url(/_nuxt/fonts/IBMPlexSans-Light.6deeae9.woff) format("woff");font-weight:300;font-style:normal;font-display:swap}@font-face{font-family:"IBM Plex Sans";src:url(/_nuxt/fonts/IBMPlexSans-Thin.48a004c.woff2) format("woff2"),url(/_nuxt/fonts/IBMPlexSans-Thin.a0bf478.woff) format("woff");font-weight:100;font-style:normal;font-display:swap}@font-face{font-family:"IBM Plex Sans";src:url(/_nuxt/fonts/IBMPlexSans-SemiBoldItalic.1ea1b42.woff2) format("woff2"),url(/_nuxt/fonts/IBMPlexSans-SemiBoldItalic.51a17ed.woff) format("woff");font-weight:600;font-style:italic;font-display:swap}@font-face{font-family:"IBM Plex Sans";src:url(/_nuxt/fonts/IBMPlexSans-Regular.8a1d71e.woff2) format("woff2"),url(/_nuxt/fonts/IBMPlexSans-Regular.f578949.woff) format("woff");font-weight:400;font-style:normal;font-display:swap}@font-face{font-family:"IBM Plex Mono";src:url(/_nuxt/fonts/IBMPlexMono-BoldItalic.dfc303c.woff2) format("woff2"),url(/_nuxt/fonts/IBMPlexMono-BoldItalic.4e61f02.woff) format("woff");font-weight:700;font-style:italic;font-display:swap}@font-face{font-family:"IBM Plex Mono";src:url(/_nuxt/fonts/IBMPlexMono-Medium.147a566.woff2) format("woff2"),url(/_nuxt/fonts/IBMPlexMono-Medium.7ff5157.woff) format("woff");font-weight:500;font-style:normal;font-display:swap}@font-face{font-family:"IBM Plex Mono";src:url(/_nuxt/fonts/IBMPlexMono-Light.5a1f45e.woff2) format("woff2"),url(/_nuxt/fonts/IBMPlexMono-Light.18d1c63.woff) format("woff");font-weight:300;font-style:normal;font-display:swap}@font-face{font-family:"IBM Plex Mono";src:url(/_nuxt/fonts/IBMPlexMono-MediumItalic.fc6c5cb.woff2) format("woff2"),url(/_nuxt/fonts/IBMPlexMono-MediumItalic.d438c7d.woff) format("woff");font-weight:500;font-style:italic;font-display:swap}@font-face{font-family:"IBM Plex Mono";src:url(/_nuxt/fonts/IBMPlexMono-Italic.cd0ddb1.woff2) format("woff2"),url(/_nuxt/fonts/IBMPlexMono-Italic.ba043e3.woff) format("woff");font-weight:400;font-style:italic;font-display:swap}@font-face{font-family:"IBM Plex Mono";src:url(/_nuxt/fonts/IBMPlexMono-Bold.1d05f1f.woff2) format("woff2"),url(/_nuxt/fonts/IBMPlexMono-Bold.b42d57c.woff) format("woff");font-weight:700;font-style:normal;font-display:swap}@font-face{font-family:"IBM Plex Mono";src:url(/_nuxt/fonts/IBMPlexMono-ExtraLightItalic.d6ddd0e.woff2) format("woff2"),url(/_nuxt/fonts/IBMPlexMono-ExtraLightItalic.42c307f.woff) format("woff");font-weight:200;font-style:italic;font-display:swap}@font-face{font-family:"IBM Plex Mono";src:url(/_nuxt/fonts/IBMPlexMono-LightItalic.2552638.woff2) format("woff2"),url(/_nuxt/fonts/IBMPlexMono-LightItalic.94f0e32.woff) format("woff");font-weight:300;font-style:italic;font-display:swap}@font-face{font-family:"IBM Plex Mono";src:url(/_nuxt/fonts/IBMPlexMono-ExtraLight.b1e481e.woff2) format("woff2"),url(/_nuxt/fonts/IBMPlexMono-ExtraLight.0e72c65.woff) format("woff");font-weight:200;font-style:normal;font-display:swap}@font-face{font-family:"IBM Plex Mono";src:url(/_nuxt/fonts/IBMPlexMono-SemiBoldItalic.8a67a3f.woff2) format("woff2"),url(/_nuxt/fonts/IBMPlexMono-SemiBoldItalic.7d351c4.woff) format("woff");font-weight:600;font-style:italic;font-display:swap}@font-face{font-family:"IBM Plex Mono";src:url(/_nuxt/fonts/IBMPlexMono-Thin.b866527.woff2) format("woff2"),url(/_nuxt/fonts/IBMPlexMono-Thin.bebab09.woff) format("woff");font-weight:100;font-style:normal;font-display:swap}@font-face{font-family:"IBM Plex Mono";src:url(/_nuxt/fonts/IBMPlexMono-SemiBold.38bc1dc.woff2) format("woff2"),url(/_nuxt/fonts/IBMPlexMono-SemiBold.050dbf6.woff) format("woff");font-weight:600;font-style:normal;font-display:swap}@font-face{font-family:"IBM Plex Mono";src:url(/_nuxt/fonts/IBMPlexMono-Regular.56d2027.woff2) format("woff2"),url(/_nuxt/fonts/IBMPlexMono-Regular.6db7b67.woff) format("woff");font-weight:400;font-style:normal;font-display:swap}@font-face{font-family:"IBM Plex Mono";src:url(/_nuxt/fonts/IBMPlexMono-ThinItalic.77a6c5b.woff2) format("woff2"),url(/_nuxt/fonts/IBMPlexMono-ThinItalic.10ed423.woff) format("woff");font-weight:100;font-style:italic;font-display:swap}body{font-family:"IBM Plex Sans",sans-serif;font-display:block;background-color:#fbf5ee;margin:0;padding:0}*{box-sizing:border-box}.nuxt-progress{position:fixed;top:0;left:0;right:0;height:2px;width:0;opacity:1;transition:width .1s,opacity .4s;background-color:#000;z-index:999999}.nuxt-progress.nuxt-progress-notransition{transition:none}.nuxt-progress-failed{background-color:red}.header[data-v-3ead3413]{display:flex;max-width:1200px;width:100%;margin:20px auto;padding:0 10px}.logo[data-v-3ead3413]{font:400 50px/54px IBM Plex Sans,sans-serif;margin-right:auto;color:#000;text-decoration:none}@media only screen and (max-width:595px){.logo[data-v-3ead3413]{font:400 40px/42px IBM Plex Sans,sans-serif}}.slogan[data-v-3ead3413]{font:300 20px/27px IBM Plex Sans,sans-serif;max-width:271px;margin-top:7px;margin-right:20px}@media only screen and (max-width:595px){.slogan[data-v-3ead3413]{display:none}}.links[data-v-3ead3413]{margin-top:9px}.link[data-v-3ead3413]{font:300 20px/27px IBM Plex Sans,sans-serif;color:#3a4a6a;display:block;margin-bottom:3px}@media only screen and (max-width:595px){.link[data-v-3ead3413]{font:300 17px/21px IBM Plex Sans,sans-serif}}.hero-title[data-v-9a6ba7c8]{background-color:#ebec96;opacity:.8;background-size:40px 40px}.hero-title__tag[data-v-9a6ba7c8]{padding:12px 17px;font:600 17px IBM Plex Sans,sans-serif;background-color:#fff;display:inline-flex;border-radius:12px}.hero-title__tag[data-v-9a6ba7c8]:not(:last-of-type){margin-right:24px}.hero-title__title[data-v-9a6ba7c8]{font:normal 62px/68px IBM Plex Sans,sans-serif;margin:18px 0 0;max-width:1000px;color:#000}@media only screen and (max-width:595px){.hero-title__title[data-v-9a6ba7c8]{font:normal 54px/58px IBM Plex Sans,sans-serif;margin:18px 0 0}}.hero-title__container[data-v-9a6ba7c8]{max-width:1200px;width:100%;margin:auto}.hero-title__subtitle[data-v-9a6ba7c8]{margin-top:22px;font:300 28px/33px IBM Plex Sans,sans-serif;max-width:800px;color:#000}.hero-title__image[data-v-9a6ba7c8]{margin-top:59px;border:10px solid #fff;overflow:hidden;max-width:100%}.hero-title__text-container[data-v-9a6ba7c8]{padding:35px 10px 60px}.container_common{max-width:1200px;width:100%;margin:0 auto 20px;padding:50px 10px 0}.container_content{max-width:800px}.title_h2{margin:0 0 20px;padding:0;color:#c91010;font:normal 28px IBM Plex Sans,sans-serif}.title_h3{font-size:19px;font-weight:700;margin:0 0 8px;letter-spacing:.2px}.paragraph{font-size:19px}.paragraph:first-of-type{margin-top:0}.spacing_vertical-section{height:22px}.spacing_vertical-section_sub{margin-bottom:30px}.code-block{background:#fff;padding:10px 12px;overflow-x:scroll;margin:0 0 18px;color:#151577}.code-block_short{padding:6px 12px}.code-block__filename{background:#dbf0ff;padding:6px 12px;display:flex;align-items:center;font-weight:400}.code-block__file-icon{height:1em;margin-right:5px}.links-list{list-style-type:none;margin:0;padding:0}.links-list__link{color:#b66e6e;display:flex}.links-list>li{margin-bottom:10px;font-size:16px}.links-list__link:before{content:" ";background-image:url(/_nuxt/img/link-2.ca17a71.svg);background-repeat:no-repeat;margin-right:4px;margin-top:2px;display:block;width:1em;height:1em}.block-with-photo{margin-bottom:22px}.block-with-photo__paragraph{font:400 14px "IBM Plex Sans",sans-serif;color:#888}.block-with-photo__photo{max-width:100%}</style><link rel="preload" href="/_nuxt/static/1643134303/posts/rails-on-docker/state.js" as="script"><link rel="preload" href="/_nuxt/static/1643134303/posts/rails-on-docker/payload.js" as="script"><link rel="preload" href="/_nuxt/static/1643134303/manifest.js" as="script">
  </head>
  <body>
    <div data-server-rendered="true" id="__nuxt"><!----><div id="__layout"><div><div class="header" data-v-3ead3413><a href="/" class="logo nuxt-link-active" data-v-3ead3413>
    Maxim<br data-v-3ead3413>Rukomoynikov
  </a> <div class="slogan" data-v-3ead3413>
    I love to create. Developer and designer. Looking forward to make cool things.
  </div> <div class="links" data-v-3ead3413><a href="https://twitter.com/Rukomoynikov" class="link" data-v-3ead3413>twitter</a> <a href="https://www.facebook.com/rukomoynikov" class="link" data-v-3ead3413>facebook</a> <a href="https://www.behance.net/ruq" class="link" data-v-3ead3413>behance</a></div></div> <div><!----> <div class="hero-title" data-v-9a6ba7c8><div class="hero-title__container" data-v-9a6ba7c8><div class="hero-title__text-container" data-v-9a6ba7c8><div class="hero-title__tag" data-v-9a6ba7c8>
        Ruby
      </div><div class="hero-title__tag" data-v-9a6ba7c8>
        Docker
      </div> <h2 class="hero-title__title" data-v-9a6ba7c8>
        Hot to generate Rails app and run it without installing ruby locally
      </h2> <div class="hero-title__subtitle" data-v-9a6ba7c8>
        In internet plenty of articles about Dockerizing your existing application. But, what you can do if you don't have installed ruby locally and need to generate new app.
      </div></div></div></div> <div class="container_common"><h2 class="title_h2">
      Why Docker?
    </h2> <section><div class="container_content"><p class="paragraph">
          It has always been easier to supply the necessary tools locally. If you need to have multiple versions, then rvm or nvm solve the problem. Then came Docker. Until this year, I had successfully managed to avoid it. On projects where the guys worked with Docker, I instead installed everything locally. But, I thought that enough fighting and it's time to try to live with the idea of "docker for everything". It's simply time to admit either i work using Docker or i don't work at all.
        </p></div></section> <div class="spacing_vertical-section_sub"></div> <h2 class="title_h2">
      Generating Ruby on Rails application
    </h2> <section><div class="container_content"><p class="paragraph">
          Well I don't have ruby installed locally. And I need to generate a new Rails application or experiment in IRB.
        </p> <p class="paragraph">
          The first thing I did was look at the official Rails image. It turned out to be deprecated, and the authors suggested Ruby as a replacement. Using Ruby image, I was unable to generate a Rails application, so I made my own Docker image.
        </p> <div><!----> <pre class="code-block"><div>FROM debian:bullseye

WORKDIR /app

ARG ruby_version=2.7.1
ARG PG_MAJOR=13
ARG NODE_MAJOR=14

# Installing general packages
RUN apt update \
  && apt upgrade -y \
  && apt install libpq-dev postgresql-client-$PG_MAJOR gnupg2 git wget curl vim build-essential libssl-dev zlib1g-dev libyaml-dev libffi-dev -y

# Installing rbenv and ruby
RUN apt install rbenv -y \
  && echo 'eval "$(rbenv init -)"' >> ~/.bashrc \
  && rbenv install $ruby_version \
    && rbenv global $ruby_version \
  && eval "$(rbenv init -)" \
  && gem install rails

#Installing node and yarn
RUN curl -sL https://deb.nodesource.com/setup_$NODE_MAJOR.x | bash - \
  && apt install nodejs \
  && npm i -g yarn

ENV PATH /root/.rbenv/versions/$ruby_version/bin/:/root/.rbenv/shims:$PATH

RUN gem install rails
</div></pre></div> <ul class="links-list"><li><a href="https://hub.docker.com/repository/docker/rukomoynikov/rails/general" class="links-list__link">
      hub.docker.com/repository/docker/rukomoynikov/rails
    </a></li></ul></div></section> <div class="spacing_vertical-section_sub"></div> <section><div class="container_content"><h3 class="title_h3">
          Using the image
        </h3> <p class="paragraph">
          The following command will generate a new Rails application in the current folder and install required gems in the gems folder. As you know, a container cannot change its content after it has been built. Therefore, all application files and gems will be stored on the host machine.
        </p> <div><!----> <pre class="code-block">docker run --rm -v /$(pwd):/app rukomoynikov/rails rails new .</pre></div> <p class="paragraph">
          Launching the application is not much more difficult. But, in a simple form, it will only work if you use the sqlite database.
        </p> <div><!----> <pre class="code-block">docker run --rm -it -p 3000:3000 -v /$(pwd):/app rukomoynikov/rails rails s -b 0.0.0.0</pre></div> <p class="paragraph">
          Running IRB. Or you can enter console and run ruby files from local machine.
        </p> <div><!----> <pre class="code-block">docker run --rm -it -p 3000:3000 -v /$(pwd):/app rukomoynikov/rails bash</pre></div> <div class="block-with-photo"><picture><source srcset="/_nuxt/img/rails-basic-app.b9fc3f0.webp, /_nuxt/img/rails-basic-app@2x.21c21d2.webp 2x" type="image/webp"> <source srcset="/_nuxt/img/rails-basic-app.6e37b15.jpg, /_nuxt/img/rails-basic-app@2x.e1851b3.jpg 2x"> <img src="/_nuxt/img/rails-basic-app@2x.e1851b3.jpg" class="block-with-photo__photo"></picture> <div class="block-with-photo__paragraph">
          Ruby on Rails default page
        </div></div></div></section> <div class="spacing_vertical-section_sub"></div> <h2 class="title_h2">
      What's next?
    </h2> <section><div class="container_content"><p class="paragraph">
          Выше пример минимального Rails приложения. Для полноценного использования потребуется, что-то серьезнее чем один Dockerfile. Например, docker-compose. Там можно выделить Ruby приложение в отдельный сервис, да и клиентскую часть тоже.
        </p> <p class="paragraph">
          Ниже пример моего docker-compose.yml
        </p> <div><!----> <pre class="code-block"><div>services:
  web:
    image: rukomoynikov/rails:2.7.1
    volumes:
      - ./server:/app
      - rails_cache:/app/tmp/cache
      - bundle:/usr/local/bundle
    ports:
      - 3000:3000
    volumes:
      - "./server/:/app"
    tmpfs:
      - /tmp
      - /app/tmp/pids
    depends_on:
      postgres:
        condition: service_healthy
      redis:
        condition: service_healthy
    command: bundle exec rails server -b 0.0.0.0
  client:
    image: rukomoynikov/rails:2.7.1
    command: yarn run build -w
    ports:
      - '3035:3035'
    volumes:
      - ./server:/app:cached
      - bundle:/usr/local/bundle
      - node_modules:/app/node_modules
      - packs:/app/public/packs
    environment:
      WEBPACKER_DEV_SERVER_HOST: 0.0.0.0
  postgres:
    image: postgres:13
    volumes:
      - postgres:/var/lib/postgresql/data
    environment:
      PSQL_HISTFILE: /root/log/.psql_history
      POSTGRES_PASSWORD: postgres
    ports:
      - 5432
    healthcheck:
      test: pg_isready -U postgres -h 127.0.0.1
      interval: 5s
  redis:
    image: redis:3.2-alpine
    volumes:
      - redis:/data
    ports:
      - 6379
    healthcheck:
      test: redis-cli ping
      interval: 1s
      timeout: 3s
      retries: 30

volumes:
  postgres:
  redis:
  bundle:
  rails_cache:
  node_modules:
  packs:
</div></pre></div></div></section></div></div></div></div></div><script defer src="/_nuxt/static/1643134303/posts/rails-on-docker/state.js"></script><script src="/_nuxt/0f769b2.js" defer></script><script src="/_nuxt/549224a.js" defer></script><script src="/_nuxt/6e86502.js" defer></script><script src="/_nuxt/10b8bef.js" defer></script><script src="/_nuxt/221fbe7.js" defer></script>
  </body>
</html>
