<!doctype html>
<html lang="en" dir="ltr">
	<head>
		<meta charset="utf-8" />

		<link
			rel="apple-touch-icon"
			sizes="180x180"
			href="../../favicon/apple-touch-icon.png"
		/>
		<link
			rel="icon"
			type="image/png"
			sizes="32x32"
			href="../../favicon/favicon-32x32.png"
		/>
		<link
			rel="icon"
			type="image/png"
			sizes="16x16"
			href="../../favicon/favicon-16x16.png"
		/>
		<link rel="manifest" href="../../favicon/site.webmanifest" />

		<meta name="viewport" content="width=device-width, initial-scale=1" />
		
		<link href="../../_app/immutable/assets/0.DbhTkV5p.css" rel="stylesheet">
		<link href="../../_app/immutable/assets/TwoColsContainer.Cfns4Auz.css" rel="stylesheet">
		<link href="../../_app/immutable/assets/Title.r_T7jWS_.css" rel="stylesheet">
		<link href="../../_app/immutable/assets/Paragraph.aDFaLfzd.css" rel="stylesheet">
		<link href="../../_app/immutable/assets/LinksList.6PqA1Dza.css" rel="stylesheet">
		<link href="../../_app/immutable/assets/CodeBlockInline.CTcS-m5m.css" rel="stylesheet">
		<link href="../../_app/immutable/assets/Image.tn0RQdqM.css" rel="stylesheet">
		<link href="../../_app/immutable/assets/CodeBlock.CobIdgon.css" rel="stylesheet">
		<link rel="modulepreload" href="../../_app/immutable/entry/start.B_0T8Tw_.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/entry.BJRxdhuq.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/utils.CrDVYUnt.js">
		<link rel="modulepreload" href="../../_app/immutable/entry/app.BFHGbPaq.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/legacy.kROiCmhR.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/stores.pUKqf64p.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/render.CSCXmMM-.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/props.D51blVrW.js">
		<link rel="modulepreload" href="../../_app/immutable/nodes/0.Cm467ep7.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/TwoColsContainer.zeqId5Fh.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/index.CKscP9ss.js">
		<link rel="modulepreload" href="../../_app/immutable/nodes/3.DBhgg2p7.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/lifecycle.DrXUT_Pr.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/Title.BHUhat24.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/Paragraph.CYSbAqwQ.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/LinksList.Cw5MOKHz.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/CodeBlockInline.DnGqR1Ih.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/Image.D9G_Tpcr.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/CodeBlock.st6nNm2S.js"><!--[--><meta name="description" content="Setup docker for Rails and use it for running Rails application."> <link rel="canonical" href="/posts/deploy-elixir-app-on-lightsail/"> <meta name="keywords" content="rails, ruby, typescript, react, elixir, rust"> <meta name="twitter:image" content="https://rukomoynikov.ru/_app/immutable/assets/facebook_cover_1200x630.D6J1q_ov.jpg?h=630&amp;w=1200"> <meta name="robots" content="index,follow"> <meta name="googlebot" content="index,follow"> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:site" content="@MRukomoynikov"> <meta name="twitter:description" content="Setup docker for Rails and use it for running Rails application."> <meta name="twitter:image" content="https://rukomoynikov.ru/_app/immutable/assets/facebook_cover_1200x630.D6J1q_ov.jpg?h=630&amp;w=1200"> <meta property="og:title" content="Rails on Docker"> <meta property="og:description" content="Setup docker for Rails and use it for running Rails application."> <meta property="og:image:url" content="https://rukomoynikov.ru/_app/immutable/assets/facebook_cover_1200x630.D6J1q_ov.jpg?h=630&amp;w=1200"> <meta property="og:image:width" content="1200"> <meta property="og:image:height" content="630"> <meta property="og:image:alt" content="Rails on Docker"> <meta property="og:url" content="/posts/deploy-elixir-app-on-lightsail/"> <meta property="og:type" content="website"> <meta property="og:site_name" content="Rails on Docker"><!--]--><title>Rails on Docker</title>
	</head>
	<body data-sveltekit-preload-data="hover">
		<div style="display: contents"><!--[--><!--[--><!----><div class="container--1200 svelte-1i3ol08"><!----><div class="columns standard svelte-1usoguu"><div class="col-1 svelte-1usoguu"><!----><h1 class="svelte-1ckgkw7"><a href="/" class="svelte-1ckgkw7">Max Rukomoynikov</a></h1> <div>I love to create. Developer and designer. Looking forward to make cool things.</div><!----></div> <!--[!--><!--]--></div><!----></div><!----> <!----><div class="container--1200 svelte-1i3ol08"><!----><!----><h1 class="null svelte-hffrw8"><!----><!---->How to deploy Elixir LiveView app to Amazon Lightsail<!----><!----></h1><!----><!----> <div class="columns standard svelte-1usoguu"><div class="col-1 svelte-1usoguu"><!----><p class="paragraph svelte-5wsfqn"><!----><!---->During this article, I will lead you from the basics of Lightsail to fully furnished automatic CI\CD to Lightsail.<!----></p><!----></div> <!--[!--><!--]--></div><!----> <!----><h2 class="null svelte-hffrw8"><!----><!---->What is Lightail in general?<!----><!----></h2><!----><!----> <div class="columns standard svelte-1usoguu"><div class="col-1 svelte-1usoguu"><!----><p class="paragraph svelte-5wsfqn"><!----><!---->Lightsail - new service from Amazon Cloud. Treat it like a younger brother of Amazon EC2. Though being a light version of EC2, it supports all essential tools. At the moment, you can use VPS, container services, hosted databases, load balancers and permanent storage and backups. Not bad, hah?<!----></p><!----> <p class="paragraph svelte-5wsfqn"><!----><!---->In this tutorial, I will use container service, which is something similar to Amazon Fargate + EC2 but much easier in configuration. So, basically, what this service does is running Docker containers. And this is what we need to run our Elixir application.<!----></p><!----><!----></div> <!--[--><div class="col-2 svelte-1usoguu"><!----><div slot="aside"><ul class="links-list svelte-5n4j8k"><!--[--><li class="svelte-5n4j8k"><a href="https://lightsail.aws.amazon.com" class="links-list__link svelte-5n4j8k">Amazon Lightsail</a></li><li class="svelte-5n4j8k"><a href="https://www.youtube.com/watch?v=RhcR5LaRXIQ" class="links-list__link svelte-5n4j8k">Deploy your first containerized application (Youtube)</a></li><!--]--></ul><!----></div><!----></div><!--]--></div><!----> <!----><h2 class="null svelte-hffrw8"><!----><!---->Phoenix LiveView application<!----><!----></h2><!----><!----> <div class="columns standard svelte-1usoguu"><div class="col-1 svelte-1usoguu"><!----><div class="image"><!--[--><enhanced:img src="/_app/immutable/assets/example_app.C055XKQi.png?enhanced=true" alt="Phoenix default page"></enhanced:img><!--]--></div><!----> <p class="paragraph svelte-5wsfqn"><!----><!---->To make this tale a bit simple i will not dive into creating something meaningfull. Rather we
			will create a basic boilerplate with Ecto and Postgres.<!----></p><!----> <p class="paragraph svelte-5wsfqn"><!----><!---->Well done! Now it's time to make a commit and if you want to look at your new shiny project
			run local server <span class="code svelte-9l3qyq"><!----><!---->mix phx.server<!----></span><!---->.<!----></p><!----><!----></div> <!--[--><div class="col-2 svelte-1usoguu"><!----><div slot="aside"><ul class="links-list svelte-5n4j8k"><!--[--><li class="svelte-5n4j8k"><a href="https://lightsail.aws.amazon.com" class="links-list__link svelte-5n4j8k">Example application on Github</a></li><!--]--></ul><!----></div><!----></div><!--]--></div><!----> <!----><h2 class="null svelte-hffrw8"><!----><!---->Lightsail required setup<!----><!----></h2><!----><!----> <div class="columns standard svelte-1usoguu"><div class="col-1 svelte-1usoguu"><!----><div class="image"><!--[--><enhanced:img src="/_app/immutable/assets/light-sail-empty-container-service.CaqL981E.png?enhanced=true" alt="Amazon LightSail welcome page"></enhanced:img><!--]--></div><!----> <p class="paragraph svelte-5wsfqn"><!----><!---->We are one step closer to the deployed application. Deployed on Lightsail. To make it possible
			first we need to create a container service and IAM settings.<!----></p><!----> <p class="paragraph svelte-5wsfqn"><!----><!---->Let's begin from container service. First sign in to AWS console and open Lightsail section.
			At the moment Amazon offers $10 "machine" to 3 months for free. Cheapest ($15) plan for
			managed database also is free for first 3 months. Why not to give it a try? Please create a
			container service.<!----></p><!----> <div class="image"><!--[--><enhanced:img src="/_app/immutable/assets/pricing.Bm5fCeME.png?enhanced=true" alt="Amazon LightSail pricing"></enhanced:img><!--]--></div><!----> <p class="paragraph svelte-5wsfqn"><!----><!---->On the creation screen: change region if needed, leave "Set up your first deployment" as is.
			In the field "Identify your service" enter desired name and save it somewhere. "Container
			service name" will be used later in CI settings.<!----></p><!----><!----></div> <!--[!--><!--]--></div><!----> <!----><h3 class="null svelte-hffrw8"><!----><!---->IAM roles<!----><!----></h3><!----><!----> <div class="columns standard svelte-1usoguu"><div class="col-1 svelte-1usoguu"><!----><p class="paragraph svelte-5wsfqn"><!----><!---->To be able interact with AWS API we need to create these two entities: policy, user. By
			default Amazon doesn't offer a policy to control Lightsail, but we are free to create it on
			our own.<!----></p><!----> <!--[--><div class="codeBlock svelte-1cmzv5q "><button class="copyButton svelte-1cmzv5q ">Copy</button> <!--[!--><!--]--> <!----><pre class="shiki dark-plus" style="background-color: #1E1E1E" tabindex="0"><code><span class="line"><span style="color: #D4D4D4">{</span></span>
<span class="line"><span style="color: #D4D4D4">	</span><span style="color: #9CDCFE">&quot;Version&quot;</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">&quot;2012-10-17&quot;</span><span style="color: #D4D4D4">,</span></span>
<span class="line"><span style="color: #D4D4D4">	</span><span style="color: #9CDCFE">&quot;Statement&quot;</span><span style="color: #D4D4D4">: [</span></span>
<span class="line"><span style="color: #D4D4D4">		{</span></span>
<span class="line"><span style="color: #D4D4D4">			</span><span style="color: #9CDCFE">&quot;Sid&quot;</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">&quot;VisualEditor0&quot;</span><span style="color: #D4D4D4">,</span></span>
<span class="line"><span style="color: #D4D4D4">			</span><span style="color: #9CDCFE">&quot;Effect&quot;</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">&quot;Allow&quot;</span><span style="color: #D4D4D4">,</span></span>
<span class="line"><span style="color: #D4D4D4">			</span><span style="color: #9CDCFE">&quot;Action&quot;</span><span style="color: #D4D4D4">: [</span></span>
<span class="line"><span style="color: #D4D4D4">				</span><span style="color: #CE9178">&quot;lightsail:RegisterContainerImage&quot;</span><span style="color: #D4D4D4">,</span></span>
<span class="line"><span style="color: #D4D4D4">				</span><span style="color: #CE9178">&quot;lightsail:CreateContainerServiceRegistryLogin&quot;</span><span style="color: #D4D4D4">,</span></span>
<span class="line"><span style="color: #D4D4D4">				</span><span style="color: #CE9178">&quot;lightsail:CreateContainerServiceDeployment&quot;</span></span>
<span class="line"><span style="color: #D4D4D4">			],</span></span>
<span class="line"><span style="color: #D4D4D4">			</span><span style="color: #9CDCFE">&quot;Resource&quot;</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">&quot;*&quot;</span></span>
<span class="line"><span style="color: #D4D4D4">		}</span></span>
<span class="line"><span style="color: #D4D4D4">	]</span></span>
<span class="line"><span style="color: #D4D4D4">}</span></span>
<span class="line"></span></code></pre><!----></div><!--]--><!----><!----></div> <!--[!--><!--]--></div><!----> <!----><h2 class="null svelte-hffrw8"><!----><!---->Docker setup<!----><!----></h2><!----><!----> <div class="columns standard svelte-1usoguu"><div class="col-1 svelte-1usoguu"><!----><p class="paragraph svelte-5wsfqn"><!----><!---->Lightsail will run container we point to. So, in order to create docker container first
			Dockerfile is required. Using this file Github CI will build image and push the image to
			Lightsail image's container.<!----></p><!----> <!--[--><div class="codeBlock svelte-1cmzv5q "><button class="copyButton svelte-1cmzv5q ">Copy</button> <!--[!--><!--]--> <!----><pre class="shiki dark-plus" style="background-color: #1E1E1E" tabindex="0"><code><span class="line"><span style="color: #6A9955"># ----------------- # BASE # -----------------</span></span>
<span class="line"><span style="color: #569CD6">FROM</span><span style="color: #D4D4D4"> elixir:alpine </span><span style="color: #569CD6">AS</span><span style="color: #D4D4D4"> base</span></span>
<span class="line"><span style="color: #569CD6">WORKDIR</span><span style="color: #D4D4D4"> /app</span></span>
<span class="line"><span style="color: #569CD6">RUN</span><span style="color: #D4D4D4"> mix do local.hex --force, local.rebar --force</span></span>
<span class="line"><span style="color: #569CD6">RUN</span><span style="color: #D4D4D4"> apk add npm inotify-tools</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A9955"># ----------------- # BUILD #-----------------</span></span>
<span class="line"><span style="color: #569CD6">FROM</span><span style="color: #D4D4D4"> base </span><span style="color: #569CD6">AS</span><span style="color: #D4D4D4"> build</span></span>
<span class="line"><span style="color: #569CD6">RUN</span><span style="color: #D4D4D4"> apk add curl bash git</span></span>
<span class="line"><span style="color: #569CD6">ARG</span><span style="color: #D4D4D4"> MIX_ENV=prod</span></span>
<span class="line"><span style="color: #569CD6">ENV</span><span style="color: #D4D4D4"> MIX_ENV=$MIX_ENV</span></span>
<span class="line"><span style="color: #569CD6">COPY</span><span style="color: #D4D4D4"> ../../../../routes/posts/deploy-elixir-app-on-lightsail/snippets ./</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A9955"># install application</span></span>
<span class="line"><span style="color: #569CD6">RUN</span><span style="color: #D4D4D4"> mix do deps.get, compile</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A9955"># ----------------- # RELEASE #-----------------</span></span>
<span class="line"><span style="color: #569CD6">FROM</span><span style="color: #D4D4D4"> build </span><span style="color: #569CD6">AS</span><span style="color: #D4D4D4"> release</span></span>
<span class="line"><span style="color: #569CD6">ARG</span><span style="color: #D4D4D4"> MIX_ENV=prod</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A9955"># digests and compresses static files RUN mix assets.deploy # generate release executable</span></span>
<span class="line"><span style="color: #569CD6">RUN</span><span style="color: #D4D4D4"> mix phx.gen.release RUN mix release</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A9955"># ----------------- #PRODUCTION # -----------------</span></span>
<span class="line"><span style="color: #569CD6">FROM</span><span style="color: #D4D4D4"> elixir:alpine</span></span>
<span class="line"><span style="color: #569CD6">WORKDIR</span><span style="color: #D4D4D4"> /app</span></span>
<span class="line"><span style="color: #569CD6">ARG</span><span style="color: #D4D4D4"> MIX_ENV=prod</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A9955"># install dependencies</span></span>
<span class="line"><span style="color: #569CD6">RUN</span><span style="color: #D4D4D4"> apk add ncurses-libs curl</span></span>
<span class="line"><span style="color: #569CD6">COPY</span><span style="color: #D4D4D4"> --from=release /app/_build/prod/rel/github_dashboard ./</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A9955"># start application</span></span>
<span class="line"><span style="color: #569CD6">CMD</span><span style="color: #D4D4D4"> [</span><span style="color: #CE9178">&quot;bin/server&quot;</span><span style="color: #D4D4D4">, </span><span style="color: #CE9178">&quot;start&quot;</span><span style="color: #D4D4D4">]</span></span>
<span class="line"></span></code></pre><!----></div><!--]--><!----><!----></div> <!--[!--><!--]--></div><!----> <!----><h2 class="null svelte-hffrw8"><!----><!---->Github Actions to test and deploy<!----><!----></h2><!----><!----> <div class="columns standard svelte-1usoguu"><div class="col-1 svelte-1usoguu"><!----><p class="paragraph svelte-5wsfqn"><!----><!---->Heya! We are almost there. Let's setup CI pipeline to test our super-duper app.<!----></p><!----> <!--[--><div class="codeBlock svelte-1cmzv5q "><button class="copyButton svelte-1cmzv5q ">Copy</button> <!--[!--><!--]--> <!----><pre class="shiki dark-plus" style="background-color: #1E1E1E" tabindex="0"><code><span class="line"><span style="color: #569CD6">name</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">Elixir CI</span></span>
<span class="line"></span>
<span class="line"><span style="color: #569CD6">on</span><span style="color: #D4D4D4">:</span></span>
<span class="line"><span style="color: #569CD6">push</span><span style="color: #D4D4D4">:</span></span>
<span class="line"></span>
<span class="line"><span style="color: #569CD6">permissions</span><span style="color: #D4D4D4">:</span></span>
<span class="line"><span style="color: #569CD6">contents</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">read</span></span>
<span class="line"></span>
<span class="line"><span style="color: #569CD6">env</span><span style="color: #D4D4D4">:</span></span>
<span class="line"><span style="color: #569CD6">CONTAINER_SERVICE_NAME</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">&lt;container service name&gt;</span></span>
<span class="line"><span style="color: #569CD6">AWS_REGION</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">&lt;aws region&gt;</span></span>
<span class="line"><span style="color: #569CD6">DOCKER_TAG</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">&lt;some name to tag your docker images in Lightsail hub&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #569CD6">jobs</span><span style="color: #D4D4D4">:</span></span>
<span class="line"><span style="color: #569CD6">build</span><span style="color: #D4D4D4">:</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">name</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">Build and test</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">runs-on</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">ubuntu-latest</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">steps</span><span style="color: #D4D4D4">:</span></span>
<span class="line"><span style="color: #D4D4D4">    - </span><span style="color: #569CD6">uses</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">actions/checkout@v3</span></span>
<span class="line"><span style="color: #D4D4D4">    - </span><span style="color: #569CD6">name</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">Set up Elixir</span></span>
<span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">uses</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">erlef/setup-beam@988e02bfe678367a02564f65ca2e37726dc0268f</span></span>
<span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">with</span><span style="color: #D4D4D4">:</span></span>
<span class="line"><span style="color: #D4D4D4">        </span><span style="color: #569CD6">elixir-version</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">&#39;1.12.3&#39;</span><span style="color: #D4D4D4"> </span><span style="color: #6A9955"># Define the elixir version [required]</span></span>
<span class="line"><span style="color: #D4D4D4">        </span><span style="color: #569CD6">otp-version</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">&#39;24.1&#39;</span><span style="color: #D4D4D4"> </span><span style="color: #6A9955"># Define the OTP version [required]</span></span>
<span class="line"><span style="color: #D4D4D4">    - </span><span style="color: #569CD6">name</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">Restore dependencies cache</span></span>
<span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">uses</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">actions/cache@v3</span></span>
<span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">with</span><span style="color: #D4D4D4">:</span></span>
<span class="line"><span style="color: #D4D4D4">        </span><span style="color: #569CD6">path</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">deps</span></span>
<span class="line"><span style="color: #D4D4D4">        </span><span style="color: #569CD6">key</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">${{ runner.os }}-mix-${{ hashFiles(&#39;**/mix.lock&#39;) }}</span></span>
<span class="line"><span style="color: #D4D4D4">        </span><span style="color: #569CD6">restore-keys</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">${{ runner.os }}-mix-</span></span>
<span class="line"><span style="color: #D4D4D4">    - </span><span style="color: #569CD6">name</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">Install dependencies</span></span>
<span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">run</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">mix deps.get</span></span>
<span class="line"><span style="color: #D4D4D4">    - </span><span style="color: #569CD6">name</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">Run tests</span></span>
<span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">run</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">mix test</span></span>
<span class="line"><span style="color: #569CD6">deploy</span><span style="color: #D4D4D4">:</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">name</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">Deploy to Lightsail</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">runs-on</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">ubuntu-latest</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">steps</span><span style="color: #D4D4D4">:</span></span>
<span class="line"><span style="color: #D4D4D4">    - </span><span style="color: #569CD6">uses</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">actions/checkout@v3</span></span>
<span class="line"><span style="color: #D4D4D4">    - </span><span style="color: #569CD6">name</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">Build docker container</span></span>
<span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">run</span><span style="color: #D4D4D4">: </span><span style="color: #C586C0">|</span></span>
<span class="line"><span style="color: #CE9178">        docker build . -t $DOCKER_TAG</span></span>
<span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955"># By default AWS cli is available in Github Actions environment, but not Lightsail cli. So we need to install it manualy.</span></span>
<span class="line"><span style="color: #D4D4D4">    - </span><span style="color: #569CD6">name</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">Install LightSail AWS CLI plugin</span></span>
<span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">run</span><span style="color: #D4D4D4">: </span><span style="color: #C586C0">|</span></span>
<span class="line"><span style="color: #CE9178">        curl &quot;https://s3.us-west-2.amazonaws.com/lightsailctl/latest/linux-amd64/lightsailctl&quot; -o &quot;/usr/local/bin/lightsailctl&quot;</span></span>
<span class="line"><span style="color: #CE9178">        sudo chmod +x /usr/local/bin/lightsailctl</span></span>
<span class="line"><span style="color: #D4D4D4">    </span><span style="color: #6A9955"># Please add you AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY into your Github Repo.</span></span>
<span class="line"><span style="color: #D4D4D4">    - </span><span style="color: #569CD6">name</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">Configure AWS Credentials</span></span>
<span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">uses</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">aws-actions/configure-aws-credentials@v1</span></span>
<span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">with</span><span style="color: #D4D4D4">:</span></span>
<span class="line"><span style="color: #D4D4D4">        </span><span style="color: #569CD6">aws-access-key-id</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">${{ secrets.AWS_ACCESS_KEY_ID }}</span></span>
<span class="line"><span style="color: #D4D4D4">        </span><span style="color: #569CD6">aws-secret-access-key</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">${{ secrets.AWS_SECRET_ACCESS_KEY }}</span></span>
<span class="line"><span style="color: #D4D4D4">        </span><span style="color: #569CD6">aws-region</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">${{ env.AWS_REGION }}</span></span>
<span class="line"><span style="color: #D4D4D4">    - </span><span style="color: #569CD6">name</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">Push new version to LightSail</span></span>
<span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">run</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">aws lightsail push-container-image --region $AWS_REGION --service-name $CONTAINER_SERVICE_NAME --label $DOCKER_TAG --image $DOCKER_TAG:latest</span></span>
<span class="line"><span style="color: #D4D4D4">    - </span><span style="color: #569CD6">name</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">Deploy pushed container</span></span>
<span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">run</span><span style="color: #D4D4D4">: </span><span style="color: #CE9178">aws lightsail create-container-service-deployment --service-name $CONTAINER_SERVICE_NAME --containers file://lightsail/containers.json --public-endpoint file://lightsail/public-endpoint.json</span></span>
<span class="line"></span></code></pre><!----></div><!--]--><!----><!----></div> <!--[!--><!--]--></div><!----><!----></div><!----><!----><!----><!--]--> <!--[!--><!--]--><!--]-->
			
			<script>
				{
					__sveltekit_17i86wv = {
						base: new URL("../..", location).pathname.slice(0, -1)
					};

					const element = document.currentScript.parentElement;

					Promise.all([
						import("../../_app/immutable/entry/start.B_0T8Tw_.js"),
						import("../../_app/immutable/entry/app.BFHGbPaq.js")
					]).then(([kit, app]) => {
						kit.start(app, element, {
							node_ids: [0, 3],
							data: [null,null],
							form: null,
							error: null
						});
					});
				}
			</script>
		</div>
	</body>
</html>
